<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Learning Workflow Extension</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <h1>Learning Workflow</h1>
    
    <!-- Tab Navigation -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="steps">Steps</button>
      <button class="tab-btn" data-tab="config">Config</button>
    </div>
    
    <!-- Steps Tab -->
    <div id="stepsTab" class="tab-content active">
      <!-- Step 1: Load highlights file -->
      <div class="step">
        <h2>1. Load highlights file</h2>
        <div class="input-group">
          <label for="kindleFileInput">Select Kindle highlights file:</label>
          <input 
            type="file" 
            id="kindleFileInput" 
            accept=".html,.htm"
            class="file-input"
          />
          <div id="selectedFileName" class="selected-file-name"></div>
        </div>
        <div id="step0Status" class="status"></div>
      </div>
      
      <!-- Step 2: Select chapter to process -->
      <div class="step">
        <h2>2. Select chapter to process</h2>
        <div class="input-group" id="chapterSelectionGroup" style="display: none;">
          <label for="chapterSelect">Select a chapter:</label>
          <select id="chapterSelect" class="url-input">
            <option value="">-- Select a chapter --</option>
          </select>
        </div>
        <div id="step1Status" class="status"></div>
      </div>
    
    <!-- Step 3: Select Actions -->
    <div class="step">
      <h2>3. Select Actions</h2>
      <div class="input-group">
        <label class="checkbox-label">
          <input type="checkbox" id="actionProcessHighlights" />
          <span>Process highlights with AI</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="actionCopyToNotion" />
          <span>Copy notes to Notion</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="actionCreateGeminiQuiz" />
          <span>Create Gemini quiz</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="actionAddToNotebooklm" />
          <span>Add source to NotebookLM</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="actionGenerateFlashcards" />
          <span>Generate flashcards</span>
        </label>
      </div>
      <div class="input-group">
        <button id="performActionsBtn" class="action-btn">Perform Actions</button>
      </div>
      <div id="step2Status" class="status"></div>
    </div>
    </div>
    
    <!-- Config Tab -->
    <div id="configTab" class="tab-content">
      <div class="step">
        <h2>API Keys & Configuration</h2>
        <div class="input-group">
          <label for="configGeminiApiKey">Gemini API Key</label>
          <input 
            type="password" 
            id="configGeminiApiKey" 
            placeholder="Enter Gemini API key (optional, for AI processing)..."
            class="url-input"
          />
          <p class="help-text">Used for AI-powered highlight processing in Step 2. Get your API key from <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a>.</p>
        </div>
        <div class="input-group">
          <label for="configNotionAuthToken">Notion Integration Token</label>
          <input 
            type="password" 
            id="configNotionAuthToken" 
            placeholder="Enter Notion integration token..."
            class="url-input"
          />
          <p class="help-text">Required for Step 3. Create an integration at <a href="https://www.notion.so/my-integrations" target="_blank">Notion Integrations</a> and grant it access to your workspace/database.</p>
        </div>
        <div class="input-group">
          <label for="configNotionDatabaseUrl">Notion Database URL</label>
          <input 
            type="url" 
            id="configNotionDatabaseUrl" 
            placeholder="Paste Notion database URL here..."
            class="url-input"
          />
          <p class="help-text">Required for Step 3. The database must have a "Book Name" property, and the integration must have access to the database.</p>
        </div>
        <div class="input-group">
          <label for="configGeminiChatUrl">Gemini Chat/Gem URL</label>
          <input 
            type="url" 
            id="configGeminiChatUrl" 
            placeholder="Paste Gemini gem/chat URL here (e.g., https://gemini.google.com/gem/...)..."
            class="url-input"
          />
          <p class="help-text">Required for "Create Gemini quiz" action. The URL should point to your Gemini gem/chat.</p>
        </div>
        <div id="configStatus" class="status"></div>
        <button id="saveConfigBtn" class="action-btn">Save Configuration</button>
      </div>
    </div>
  </div>
  <script type="module" src="popup.js"></script>
</body>
</html>
